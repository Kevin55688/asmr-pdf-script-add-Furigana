# Sidebar æ–‡ä»¶åº«è¨­è¨ˆæ–‡ä»¶

- **æ—¥æœŸ**ï¼š2026-02-22
- **ç‹€æ…‹**ï¼šâ³ å¾…å¯¦ä½œ

---

## éœ€æ±‚æ‘˜è¦

| é …ç›® | æ±ºç­– |
|------|------|
| å„²å­˜ä½ç½® | å¾Œç«¯è³‡æ–™å¤¾ï¼ˆ`backend/data/library.json` + HTML æª”æ¡ˆï¼‰ |
| è³‡æ–™å¤¾çµæ§‹ | ä¸€å±¤ï¼Œç„¡å·¢ç‹€ |
| Tag ç³»çµ± | å…ˆå»ºç«‹ tagï¼Œå†å¥—ç”¨åˆ°æ–‡ä»¶ |
| æ–°å¢æ–‡ä»¶ | å…ˆå‘½åä½”ä½ï¼Œå†ä¸Šå‚³ PDF/TXT |
| æ–‡ä»¶ç§»å‹• | æ‹–æ”¾ + å³éµé¸å–® |
| ç¿»è­¯å¿«å– | å„ä¾›æ‡‰å•†ç¨ç«‹ä¿ç•™ |
| å´é‚Šæ¬„ | æ‰‹å‹•æŒ‰éˆ•æ”¶åˆ |
| ç¯©é¸æ’åº | ä¾ tag ç¯©é¸ï¼ˆAND é‚è¼¯ï¼‰ |

---

## è³‡æ–™çµæ§‹

### `backend/data/library.json`

```json
{
  "folders": [
    { "id": "f-001", "name": "ASMR è…³æœ¬", "order": 0 }
  ],
  "tags": [
    { "id": "t-001", "name": "å·²å®Œæˆ", "color": "#4ade80" },
    { "id": "t-002", "name": "é€²è¡Œä¸­", "color": "#facc15" }
  ],
  "documents": [
    {
      "id": "doc-001",
      "name": "æ£®æ—ç³»è…³æœ¬ Vol.1",
      "folderId": "f-001",
      "tagIds": ["t-001"],
      "htmlFile": "doc-001.html",
      "lastPage": 3,
      "notes": "ç¬¬5é æœ‰éœ€è¦ä¿®æ”¹çš„åœ°æ–¹",
      "translations": {
        "deepl": { "zh-TW": { "p-0": "æ£®æ—...", "p-1": "..." } },
        "claude": { "zh-TW": { "p-0": "æ£®æ—...", "p-1": "..." } }
      },
      "createdAt": "2026-02-22T10:00:00",
      "uploadedAt": "2026-02-22T10:05:00"
    }
  ]
}
```

**èªªæ˜**ï¼š
- `htmlFile` ç‚º `null` è¡¨ç¤ºæ–‡ä»¶å·²å‘½åä½†å°šæœªä¸Šå‚³
- `translations` ä»¥ä¾›æ‡‰å•† â†’ èªè¨€ â†’ æ®µè½ ID ä¸‰å±¤çµæ§‹å­˜æ”¾å¿«å–

### æª”æ¡ˆçµæ§‹

```
backend/
â””â”€â”€ data/
    â”œâ”€â”€ library.json       â† ç´¢å¼•ï¼ˆè³‡æ–™å¤¾ã€tagã€æ–‡ä»¶ metadataï¼‰
    â””â”€â”€ documents/
        â”œâ”€â”€ doc-001.html   â† è½‰æ›å¾Œçš„ HTMLï¼ˆæŒ¯ã‚Šä»®åæ¨™æ³¨å®Œæˆï¼‰
        â””â”€â”€ doc-002.html
```

---

## å¾Œç«¯ API

æ–°å¢è·¯ç”± `backend/app/routers/library.py`ï¼Œæ›è¼‰æ–¼ `/api/library`ã€‚

### è³‡æ–™å¤¾ç®¡ç†

| Method | Path | èªªæ˜ |
|--------|------|------|
| `GET` | `/api/library` | å–å¾—å®Œæ•´ libraryï¼ˆè³‡æ–™å¤¾ + tag + æ–‡ä»¶æ¸…å–®ï¼‰ |
| `POST` | `/api/library/folders` | æ–°å¢è³‡æ–™å¤¾ |
| `PATCH` | `/api/library/folders/{id}` | é‡æ–°å‘½åè³‡æ–™å¤¾ |
| `DELETE` | `/api/library/folders/{id}` | åˆªé™¤è³‡æ–™å¤¾ï¼ˆå«åº•ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼‰ |

### Tag ç®¡ç†

| Method | Path | èªªæ˜ |
|--------|------|------|
| `POST` | `/api/library/tags` | æ–°å¢ tag |
| `DELETE` | `/api/library/tags/{id}` | åˆªé™¤ tagï¼ˆè‡ªå‹•å¾æ‰€æœ‰æ–‡ä»¶ç§»é™¤ï¼‰ |

### æ–‡ä»¶ç®¡ç†

| Method | Path | èªªæ˜ |
|--------|------|------|
| `POST` | `/api/library/documents` | æ–°å¢æ–‡ä»¶ï¼ˆåªæœ‰åç¨±ï¼Œå°šæœªä¸Šå‚³ï¼‰ |
| `PATCH` | `/api/library/documents/{id}` | æ›´æ–° metadataï¼ˆç§»å‹•è³‡æ–™å¤¾ã€æ”¹åã€å‚™è¨»ã€lastPageã€tagIdsï¼‰ |
| `DELETE` | `/api/library/documents/{id}` | åˆªé™¤æ–‡ä»¶ï¼ˆå« HTML æª”æ¡ˆï¼‰ |
| `POST` | `/api/library/documents/{id}/upload` | ä¸Šå‚³ PDF/TXT ä¸¦è½‰æ›ï¼Œçµæœå­˜ç‚º HTML æª” |
| `GET` | `/api/library/documents/{id}/html` | å–å¾—å·²è½‰æ›çš„ HTML å…§å®¹ |
| `PATCH` | `/api/library/documents/{id}/translations` | å„²å­˜ç¿»è­¯å¿«å– |

**å…± 11 å€‹ endpoints**ï¼Œç¾æœ‰ `POST /api/convert` ä¿æŒä¸å‹•ï¼Œupload å…§éƒ¨å‘¼å«å…¶é‚è¼¯ã€‚

---

## å‰ç«¯ UI çµæ§‹

### æ•´é«”ç‰ˆé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Headerï¼šæŒ¯ã‚Šä»®å PDF ãµã‚ŠãŒãªãƒ„ãƒ¼ãƒ«                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          â”‚                                              â”‚
â”‚ Sidebar  â”‚  ä¸»å…§å®¹å€                                     â”‚
â”‚          â”‚                                              â”‚
â”‚ [â‰¡] æ”¶åˆ â”‚  â€¢ idleï¼šæ­¡è¿ç•«é¢ï¼ˆæç¤ºå¾å·¦å´é¸æ“‡æ–‡ä»¶ï¼‰          â”‚
â”‚          â”‚  â€¢ loadingï¼šè®€å– HTML ä¸­                      â”‚
â”‚ ğŸ” æœå°‹  â”‚  â€¢ uploadingï¼šFileUploader + ProgressBar     â”‚
â”‚ ğŸ· tagç¯© â”‚  â€¢ viewingï¼šPagedPreview                     â”‚
â”‚          â”‚                                              â”‚
â”‚ â–¼ è³‡æ–™å¤¾Aâ”‚                                              â”‚
â”‚   ğŸ“„ æ–‡ä»¶1â”‚                                             â”‚
â”‚   ğŸ“„ æ–‡ä»¶2â”‚                                             â”‚
â”‚ â–¼ è³‡æ–™å¤¾Bâ”‚                                              â”‚
â”‚   ğŸ“„ æ–‡ä»¶3â”‚                                             â”‚
â”‚          â”‚                                              â”‚
â”‚ [+ æ–°å¢] â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ”¶åˆå¾Œ

```
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚[â‰¡] â”‚  ä¸»å…§å®¹å€ï¼ˆå…¨å¯¬ï¼‰                                    â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ–°å…ƒä»¶æ¸…å–®

| å…ƒä»¶ | èªªæ˜ |
|------|------|
| `Sidebar` | å®¹å™¨ï¼Œå«æ”¶åˆç‹€æ…‹ã€å¯¬åº¦å‹•ç•« |
| `FolderItem` | è³‡æ–™å¤¾åˆ—ï¼ˆå¯å±•é–‹/æ”¶åˆã€å³éµé¸å–®ï¼‰ |
| `DocumentItem` | æ–‡ä»¶åˆ—ï¼ˆå¯æ‹–æ›³ã€å³éµé¸å–®ã€ä¸Šå‚³ç‹€æ…‹æ¨™ç¤ºï¼‰ |
| `TagManager` | Tag å»ºç«‹èˆ‡ç®¡ç†é¢æ¿ |
| `TagFilter` | å´é‚Šæ¬„é ‚éƒ¨çš„ tag ç¯©é¸åˆ— |
| `DocumentContextMenu` | å³éµé¸å–®ï¼ˆé‡æ–°å‘½åã€ç§»å‹•åˆ°ã€åˆªé™¤ï¼‰ |
| `NotesPanel` | å‚™è¨»è¼¸å…¥ï¼ˆPagedPreview å³ä¸‹è§’æµ®å‹•æŒ‰éˆ•ï¼‰ |

### App.tsx ç‹€æ…‹æ©Ÿ

```
idleï¼ˆæœªé¸æ–‡ä»¶ï¼‰
  â””â”€ é»é¸æ–‡ä»¶ï¼ˆå·²ä¸Šå‚³ï¼‰â†’ loading â†’ viewingï¼ˆPagedPreviewï¼‰
  â””â”€ é»é¸æ–‡ä»¶ï¼ˆæœªä¸Šå‚³ï¼‰â†’ uploadingï¼ˆFileUploaderï¼‰
                           â””â”€ æˆåŠŸ â†’ viewing
```

---

## äº’å‹•ç´°ç¯€

### æ‹–æ”¾ç§»å‹•æ–‡ä»¶

- æ‹–æ›³ä¸­ï¼šç›®æ¨™ FolderItem é«˜äº®é¡¯ç¤º
- æ”¾ä¸‹ï¼š`PATCH /api/library/documents/{id}` `{ folderId: "f-xxx" }`
- UI ç«‹å³æ›´æ–°æ–‡ä»¶ä½ç½®

### å³éµé¸å–®

| æ–‡ä»¶ç‹€æ…‹ | é¸å–®é …ç›® |
|---------|---------|
| æœªä¸Šå‚³ | ä¸Šå‚³æª”æ¡ˆã€é‡æ–°å‘½åã€ç§»å‹•åˆ°ã€åˆªé™¤ |
| å·²ä¸Šå‚³ | é‡æ–°å‘½åã€ç§»å‹•åˆ°ã€é‡æ–°ä¸Šå‚³ã€åˆªé™¤ |

### Tag ç¯©é¸é‚è¼¯

- æœªé¸ tag â†’ é¡¯ç¤ºæ‰€æœ‰æ–‡ä»¶
- é¸å¤šå€‹ tag â†’ AND é‚è¼¯ï¼ˆåŒæ™‚å«æœ‰æ‰€æœ‰é¸ä¸­ tagï¼‰
- ç¯©é¸åªå½±éŸ¿æ–‡ä»¶åˆ—è¡¨ï¼Œè³‡æ–™å¤¾çµæ§‹ä»é¡¯ç¤º

### æœ€å¾Œé–±è®€é æ•¸

- æ›é æ™‚ debounce 1 ç§’å¾Œå‘¼å« `PATCH` å„²å­˜ `lastPage`
- ä¸‹æ¬¡é–‹å•Ÿæ–‡ä»¶ç›´æ¥è·³åˆ° `lastPage`

### å‚™è¨»é¢æ¿

- ä½ç½®ï¼šPagedPreview å³ä¸‹è§’æµ®å‹•æŒ‰éˆ•
- å¤±å»ç„¦é»æ™‚è‡ªå‹•å„²å­˜ï¼ˆ`PATCH` å‚™è¨»ï¼‰

### ç¿»è­¯å¿«å–

- ç¿»è­¯å®Œæˆå¾Œç«‹å³ `PATCH` å„²å­˜åˆ° `translations[provider][lang]`
- ä¸‹æ¬¡é–‹å•ŸåŒæ–‡ä»¶ã€åŒä¾›æ‡‰å•†ï¼Œç›´æ¥å¾å¿«å–é¡¯ç¤ºï¼Œä¸é‡æ–°å‘¼å«ç¿»è­¯ API
